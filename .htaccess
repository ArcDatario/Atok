RewriteEngine On

# --------------------------------------
# Custom 404 Error Page
# --------------------------------------
ErrorDocument 404 /error-404.php

# --------------------------------------
# BLOCK 1: Direct access to processing PHP files (keep them as .php)
# --------------------------------------
RewriteCond %{REQUEST_URI} \.php$ [NC]
RewriteRule ^ - [L]

# --------------------------------------
# BLOCK 2: Exclude existing files and directories
# --------------------------------------
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# --------------------------------------
# BLOCK 3: Clean URLs - if no extension, try adding .php
# --------------------------------------
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L]

# --------------------------------------
# BLOCK 4: Specific routes that should go to index.php
# --------------------------------------
RewriteCond %{REQUEST_URI} ^/(atok/)?(home|dashboard|login|settings|profile)/?$ [NC]
RewriteRule ^ index.php [L]

# --------------------------------------
# BLOCK 5: 404 for all other non-existent files
# --------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php !-f
RewriteRule ^ - [R=404]